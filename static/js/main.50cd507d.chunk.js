(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{152:function(e,t,n){e.exports=n(346)},346:function(e,t,n){"use strict";n.r(t);n(153),n(155);var a=n(1),r=n.n(a),c=n(60),o=n.n(c),u=n(61),i=n(144),l=n(145),s=n(150),p=n(146),d=n(151),m=n(77),f=n.n(m),b=n(29),h=n(6),v=n(36),E=n.n(v),g=n(62),A=n(54),O="MAIN_CHANGE_VIEW",_="MAIN_CHANGE_PANEL",k="MAIN_CHANGE_FETCHED_USER",j="MAIN_CHANGE_ACTIVE_TAB",y="MAIN_CHANGE_AUTH_TOKEN",w={activeView:"main",activePanel:"main",activePanelProps:null,activeTab:"groups",fetchedUser:null,authToken:null},P=function(e,t){return function(n){n({type:_,payload:{panel:e,data:t}})}},T=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:w,t=arguments.length>1?arguments[1]:void 0,n=t.payload;switch(t.type){case O:return Object(A.a)({},e,{activeView:n.view,activePanel:n.panel});case _:return Object(A.a)({},e,{activePanel:n.panel,activePanelProps:n.data});case j:return Object(A.a)({},e,{activeTab:n});case k:return Object(A.a)({},e,{fetchedUser:n});case y:return Object(A.a)({},e,{authToken:n});default:return e}},C=n(63),I=function(){var e=Object(g.a)(E.a.mark(function e(t,n){return E.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u.a.send("VKWebAppCallAPIMethod",{method:"groups.get",params:{user_id:n,fields:"members_count",extended:!0,v:"5.95",access_token:t}});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}(),V=function(){var e=Object(g.a)(E.a.mark(function e(t,n){return E.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u.a.send("VKWebAppCallAPIMethod",{method:"friends.get",params:{user_id:n,order:"random",fields:"photo_100",name_case:"nom",v:"5.95",access_token:t}});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}(),G=function(e){var t=e.userGroups;return r.a.createElement(h.List,null,t.map(function(e){return r.a.createElement(h.Cell,{key:e.id,before:r.a.createElement(h.Avatar,{src:e.photo_200}),description:"".concat(e.members_count," \u041f\u043e\u0434\u043f\u0438\u0441\u0447\u0438\u043a\u043e\u0432")},e.name)}))},H={changePanel:P},N=Object(b.b)(null,H)(function(e){var t=e.userFriends,n=e.changePanel;return r.a.createElement(h.List,null,t.map(function(e){return r.a.createElement(h.Cell,{onClick:function(){n("friendGroups",{id:e.id,fullname:"".concat(e.first_name," ").concat(e.last_name)})},key:e.id,before:r.a.createElement(h.Avatar,{size:48,src:e.photo_100})},e.first_name," ",e.last_name)}))}),x={changeActiveTab:function(e){return function(){var t=Object(g.a)(E.a.mark(function t(n){return E.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:n({type:j,payload:e});case 1:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}()}},U=Object(b.b)(function(e){return e.main},x)(function(e){var t=Object(a.useState)([]),n=Object(C.a)(t,2),c=n[0],o=n[1],u=Object(a.useState)([]),i=Object(C.a)(u,2),l=i[0],s=i[1],p=e.activeTab,d=e.fetchedUser,m=e.changeActiveTab,f=e.authToken;d&&f&&(0===c.length&&function(e,t){I(e,t).then(function(e){var t=e.data.response.items;o(t)})}(f,d.id),0===l.length&&function(e,t){V(e,t).then(function(e){var t=e.data.response.items;s(t)})}(f,d.id));return r.a.createElement(a.Fragment,null,r.a.createElement(h.PanelHeader,{noShadow:!0},"\u041c\u043e\u0439 \u043f\u0430\u0431\u043b\u0438\u043a"),r.a.createElement(h.FixedLayout,{vertical:"top"},r.a.createElement(h.Tabs,{type:"buttons",theme:"header"},r.a.createElement(h.HorizontalScroll,null,r.a.createElement(h.TabsItem,{onClick:function(){m("groups")},selected:"groups"===p},"\u041c\u043e\u0438 \u0433\u0440\u0443\u043f\u043f\u044b"),r.a.createElement(h.TabsItem,{onClick:function(){m("friends")},selected:"friends"===p},"\u041c\u043e\u0438 \u0434\u0440\u0443\u0437\u044c\u044f"),r.a.createElement(h.TabsItem,{onClick:function(){m("friendsRecommendations")},selected:"friendsRecommendations"===p},"\u0420\u0435\u043a\u043e\u043c\u0435\u043d\u0434\u0430\u0446\u0438\u0438 \u0434\u0440\u0443\u0437\u0435\u0439")))),r.a.createElement("div",{id:"content",style:{marginTop:"48px"}},function(){switch(p){case"groups":return r.a.createElement(G,{userGroups:c});case"friends":return r.a.createElement(N,{userFriends:l});default:return null}}()))}),F=n(107),K=n.n(F),M=n(148),W=n.n(M),S=Object(h.platform)(),R={changePanel:P},B=Object(b.b)(function(e){return e.main},R)(function(e){var t=e.activePanelProps,n=t.id,c=t.fullname,o=e.authToken,u=e.changePanel,i=Object(a.useState)([]),l=Object(C.a)(i,2),s=l[0],p=l[1];return r.a.createElement(a.Fragment,null,r.a.createElement(h.PanelHeader,{addon:r.a.createElement(h.HeaderButton,{onClick:function(){u("main",{})}},"\u041d\u0430\u0437\u0430\u0434"),left:r.a.createElement(h.HeaderButton,null,S===h.IOS?r.a.createElement(W.a,null):r.a.createElement(K.a,null))},c),r.a.createElement("div",null,function(e){return 0===s.length?(I(o,e).then(function(e){p(e.data.response.items)}),null):r.a.createElement(G,{userGroups:s})}(n)))}),L=(n(345),function(e){function t(){var e,n;Object(i.a)(this,t);for(var a=arguments.length,r=new Array(a),c=0;c<a;c++)r[c]=arguments[c];return(n=Object(s.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).go=function(e){n.props.changePanel(e.currentTarget.dataset.to,null)},n}return Object(d.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=this.props,t=e.changeFetchedUser,n=e.changeAuthToken;f.a.subscribe(function(e){switch(e.detail.type){case"VKWebAppGetUserInfoResult":t(e.detail.data);break;case"VKWebAppAccessTokenReceived":n(e.detail.data.access_token);break;default:console.log(e.detail.type)}}),f.a.send("VKWebAppGetUserInfo",{}),f.a.send("VKWebAppGetAuthToken",{app_id:6921887,scope:"groups,friends"})}},{key:"render",value:function(){var e=this.props,t=e.activeView,n=e.activePanel;return r.a.createElement(h.Root,{activeView:t},r.a.createElement(h.View,{id:"main",activePanel:n},r.a.createElement(h.Panel,{id:"main"},r.a.createElement(U,null)),r.a.createElement(h.Panel,{id:"friendGroups"},r.a.createElement(B,null))))}}]),t}(r.a.Component)),z={changeView:function(e,t){return function(n){n({type:O,payload:{view:e,panel:t}})}},changePanel:P,changeFetchedUser:function(e){return function(t){t({type:k,payload:e})}},changeAuthToken:function(e){return function(t){console.log("new token: ",e),t({type:y,payload:e})}}},D=Object(b.b)(function(e){return e.main},z)(L),J=n(53),q=n(149),Q={main:T},X=Object(J.d)(Object(J.c)(Q),Object(J.a)(q.a));u.a.send("VKWebAppInit",{}),o.a.render(r.a.createElement(b.a,{store:X},r.a.createElement(D,null)),document.getElementById("root"))}},[[152,1,2]]]);
//# sourceMappingURL=main.50cd507d.chunk.js.map